<!DOCTYPE html>
<html lang="en">
  
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>
      Modern URL Shortener
    </title>
    <style>
      body { background: #111; color: #fff; font-family: 'Inter', sans-serif;
      min-height: 100vh; display: flex; justify-content: center; align-items:
      center; margin: 0; } .container { background: #222; padding: 2rem; border-radius:
      12px; box-shadow: 0 4px 24px rgba(0,0,0,.2); width: 100%; max-width: 400px;
      } input, button { width: 100%; padding: 0.7rem; margin-top: 1rem; border-radius:
      8px; border: none; font-size: 1rem; } button { background: #00eaff; color:
      #111; font-weight: bold; cursor: pointer; transition: background .2s; }
      button:hover { background: #00c7d4; } #result { margin-top: 1.5rem; font-size:
      1.1rem; word-break: break-all; }
    </style>
  </head>
  
  <body>
    <div class="container">
      <h1>
        Modern URL Shortener
      </h1>
      <form id="shortener-form">
        <input type="url" id="long-url" placeholder="Paste long URL here..." required
        />
        <button type="submit">
          Shorten
        </button>
      </form>
      <div id="result">
      </div>
    </div>
    <script>
      // These will be replaced or injected via your deployment environment
      const SUPABASE_URL = 'https://hudmulpaapjymrhzhmep.supabase.co'; // e.g. https://xyz.supabase.co
      const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh1ZG11bHBhYXBqeW1yaHpobWVwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU5MzI3MDksImV4cCI6MjA3MTUwODcwOX0.wopUDUi0it8hLSRojjJifLaknKPEo0JuxRhCxyMIakQ';
      const TABLE_NAME = 'urls';

      function generateShort(length = 6) {
        const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        let result = '';
        for (let i = 0; i < length; i++) {
          result += chars[Math.floor(Math.random() * chars.length)];
        }
        return result;
      }

      async
      function saveUrl(longUrl) {
        const short = generateShort();
        const resp = await fetch(`$ {
          SUPABASE_URL
        }
        /rest/v1 / $ {
          TABLE_NAME
        }`, {
          method: 'POST',
          headers: {
            'apikey': SUPABASE_ANON_KEY,
            'Authorization': `Bearer $ {
              SUPABASE_ANON_KEY
            }`,
            'Content-Type': 'application/json',
            'Prefer': 'return=representation'
          },
          body: JSON.stringify({
            long: longUrl,
            short
          }),
        });

        if (!resp.ok) {
          const errorText = await resp.text();
          throw new Error(`HTTP $ {
            resp.status
          }: $ {
            errorText
          }`);
        }

        const data = await resp.json();

        // data is an array of inserted rows, pick the first one
        if (data.length > 0) {
          return data[0];
        } else {
          throw new Error('No data returned from Supabase');
        }
      }

      document.getElementById('shortener-form').addEventListener('submit', async(e) = >{
        e.preventDefault();
        const urlInput = document.getElementById('long-url');
        const longUrl = urlInput.value.trim();
        const resultDiv = document.getElementById('result');
        resultDiv.textContent = 'Working...';

        try {
          const {
            short
          } = await saveUrl(longUrl);
          const shortUrl = `$ {
            window.location.origin
          }
          /${short}`;
        resultDiv.innerHTML = `Short URL: <a href="${shortUrl}" target="_blank">${shortUrl}</a > `;
        } catch(err) {
          resultDiv.textContent = 'Error: ' + err.message;
        }
      });
    </script>
  </body>

</html>
